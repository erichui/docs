# DNS域名解析

## 前置知识
### 域名
以 www.baiduu.com 域名为例，域名一般有以下几部分构成：
- 顶级域名：com
- 二级域名（主域名）：baidu.com
- 子域名：www.baiduu.com

其实每个域名都有根域名，上面完整域名应为 ``www.baidu.com.``。大多情况下跟域名都是可以省略的。

根据域名的结构，对应的域名服务器可以分为四类：
- 本地域名服务器：该服务器不在客户端本地，一般为网络运营商提供的线上 DNS 服务器。
- 跟域名服务器：最高层次的域名服务器，记录了所有顶级域名服务器域名和 IP 的映射
- 顶级域名服务器：管理在该服务器注册的所有二级域名
- 权威域名服务器：域名和 IP 的映射关系存放在这里

### 解析记录
DNS 解析记录除了 IP 以外，还有其他多种类型，常见类型如下：
- ``A`` 记录：域名对应的 IPv4 地址
- ``AAAA`` 记录：域名对应的 IPv6 地址
- ``CNAME`` 记录：记录将域名指向了另一个域名
- ``NS`` 记录：指定对域名进行解析的权威 DNS 服务器

其他类型可参考：[解析记录类型](https://www.volcengine.com/docs/6758/145121)

## 解析过程

DNS解析分为本地查询和线上查询两部分
1. 本地查询：
- 通过浏览器访问域名时，首先会查询浏览器缓存，如果没有进入下一级
- 然后查看系统缓存，即 HOST 文件，如果没有则进入线上查询流程
2. 线上查询：
- 首先访问本地域名服务器，如果没有缓存则进入下一级
- 访问跟域名服务器查询，如果没有缓存，则会将对应的顶级域名服务器（如.com，.cn等）地址返回给本地域名服务器
- 访问顶级域名服务器查询，如果没有缓存，则会将权威域名服务器地址返回给本地域名服务器
- 访问权威域名服务器查询，返回对应的解析记录（查询结果）
  - 解析记录如果为 ``A`` 或 ``AAAA`` 即 IP 地址则结束
  - 其他解析记录，如 ``CNAME``，则会重复上述流程直到查询到对应的 IP 地址为止
