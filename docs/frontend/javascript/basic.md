# 前端基础知识

- **什么是闭包，闭包都有哪些用途**？

闭包是一个函数及其绑定的词法作用域引用的组合。闭包可以访问函数外部的作用域。所以理论上 `JS` 中所有函数都是闭包。闭包主要有以下应用：
1. 模块化（函数式）编程：函数作为参数，比如 `map` `filter`，函数参数创建了一个闭包，可以访问和修改数组中的元素。
2. 实现私有方法：内部的变量或者方法只能通过返回闭包的函数访问。

- **介绍事件循环的原理**？

事件循环（`event loop`）可以理解为 `JS` 代码的执行过程。因为其单线程的特性只能同时执行一个任务，为了实现并发执行，`JS` 有了事件循环机制。主要工作原理如下：
1. 同步代码会放在**栈**执行，过程中有异步任务产生时会把该任务放到**任务队列**里
2. 当执行栈为空时，会依次取出任务队列的任务放到栈中执行。如此循环往复，称为事件循环。

其中任务队列又为宏任务（`macro task`）和微任务（`micro task`）。常见任务如下：

**宏任务**：`setTimeout, setInterval, setImmediate`。

**微任务**：`promise.then, promise.catch, process.nextTick, dom MutationObserver`.

执行栈清空以后会先检查执行 `micro task`，然后在检查执行 `macro task`。

**因此微任务比宏任务先执行，并且微任务队列一般只有一个，宏任务队列可以有多个。**

**微任务执行过程中产生新的微任务也在当前循环中执行，宏任务则会在下轮事件循环执行。** 如下代码产生新的微任务会导致一直压栈，导致栈溢出：

```ts
// 产生新的微任务会执行函数本身 fooMicro 一直入栈 导致栈溢出 页面会卡死
function fooMicro() {
  Promise.resolve().then(() => fooMicro()); 
};

// 虽然 fooMacro 会一直入栈 但每次入栈前 执行栈已空 不会导致栈溢出
function fooMacro() {
  setTimeout(fooMacro, 0); 
};
```